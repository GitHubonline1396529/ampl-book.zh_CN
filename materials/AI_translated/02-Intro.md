
# 引言

正如本书标题所示，本书的主题有两个方面。第一个是 数学规划 (mathematical programming)，即在约束条件下优化多变量函数。第二个是 AMPL 建模语言，这是我们设计并实现的一种语言，旨在帮助人们使用计算机开发和应用数学规划模型。

我们编写本书的目的是同时介绍数学规划和 AMPL。对于已经熟悉数学规划的读者，本书可以作为 AMPL 软件的用户指南和参考手册。我们不假设读者具备该领域的任何先前知识，并希望本书也能鼓励初学者使用数学规划模型。

# 数学规划

到 1940 年，“programming”一词已被用来描述大型组织内活动的规划或调度。“programmers”发现，他们可以将每项活动的数量或水平表示为一个变量，其值待定。然后，他们可以数学地描述规划或调度问题中固有的限制，作为涉及这些变量的一组方程或不等式。满足所有这些约束条件的解将被视为一个可接受的计划或调度。

经验很快表明，仅仅通过指定约束条件来建模复杂操作是很困难的。如果约束条件太少，许多劣质解可能满足它们；如果约束条件太多，则排除了理想的解，或者在最坏的情况下，可能没有可行解。编程的成功最终取决于一个关键的洞察，提供了一种绕过这一困难的方法。除了约束条件之外，还可以指定一个目标：一个变量的函数（如成本或利润），用于判断一个解是否优于另一个解。这样一来，许多不同的解满足约束条件就无关紧要了——只需找到一个使目标函数最小化或最大化的解即可。术语“数学规划”开始用来描述在变量约束条件下，对多变量目标函数的最小化或最大化。

在数学规划的发展和应用中，有一个特殊情况尤为突出：即所有成本、需求和其他相关量都是与活动水平严格成比例的项，或这些项的和。在数学术语中，目标是一个 线性函数 (linear function)，而约束是 线性方程 (linear equations) 和 不等式 (inequalities)。这样的问题被称为 线性规划 (linear programming)，设置并求解此类问题的过程称为线性规划。线性规划特别重要，因为各种各样的问题都可以建模为线性规划，并且即使有数千个变量和约束条件，也有快速而可靠的求解方法。线性规划的思想对于分析和求解非线性的数学规划问题也很重要。

所有有效的线性规划求解方法都需要计算机。因此，线性规划的研究大多发生在 1940 年代末之后，当时人们逐渐明确计算机将可用于科学计算。第一个成功的线性规划计算方法—— 单纯形法 (simplex method)，正是在此时提出的，并在接下来的十年中得到了越来越有效的实现。巧合的是，计算机的发展也使“programming”一词有了如今更为人熟知的含义。

尽管线性规划 (linear program) 具有广泛的应用性，但线性假设有时过于不切实际。如果在目标函数或约束条件中使用了变量的某些光滑非线性函数，则该问题被称为非线性规划 (nonlinear program)。求解此类问题更为困难，尽管在实践中并非不可能。虽然非线性函数的最优值问题已经被研究了两个多世纪，但在许多变量的非线性规划问题中，计算方法直到最近几十年才得到发展，这发生在 (linear programming) 方法取得成功之后。因此，数学规划领域也被称为大规模优化 (large scale optimization)，以区别于数学分析中的经典优化主题。

如果某些变量必须取整数值，则线性规划的假设也会失效。此时该问题被称为整数规划 (integer programming)，通常会变得更加困难。然而，随着计算机速度的提升和方法的日益精进，近年来大规模整数规划问题变得越来越易于处理。

# AMPL 建模语言

实际的数学规划很少像在计算机上运行某种算法并打印最优解那样简单。完整的事件序列更接近于以下过程：

- 建立模型，即构建变量、目标函数和约束条件的抽象系统，用于表示待解决问题的一般形式。
- 收集定义特定问题实例的数据。
- 根据模型和数据生成特定的目标函数和约束方程。

通过运行程序（或称为求解器 (solver)）来求解该问题实例，应用算法以找到变量的最优值。分析结果。根据需要改进模型和数据，并重复上述过程。

如果人们能够像求解器那样处理数学规划问题，那么建模中的模型构建和生成阶段可能会相对简单。然而，实际上，人类建模者理解问题的形式与求解器算法处理问题的形式之间存在诸多差异。因此，从“建模者的形式”转换为“算法的形式”是一个耗时、昂贵且常常容易出错的过程。

在线性规划这一特殊情况下，算法形式的主要部分是约束系数矩阵，即在所有约束条件中与所有变量相乘的数值表格。通常这是一个非常稀疏（大多数元素为零）的矩阵，其行数和列数从数百到数十万不等，非零元素以复杂的方式分布。用于生成系数紧凑表示的计算机程序称为矩阵生成器 (matrix generator)。已经专门设计了几种编程语言用于编写矩阵生成器，同时标准的计算机编程语言也经常被使用。

尽管矩阵生成器可以成功地自动完成一部分从建模者形式到算法形式的翻译工作，但它们仍然难以调试和维护。解决这一难题的一种方法是使用数学规划的建模语言 (modeling language)。建模语言旨在以一种可作为计算机系统直接输入的方式表达建模者的形式。然后，到算法形式的翻译可以完全由计算机执行，而无需中间的计算机编程阶段。建模语言可以帮助使数学规划更加经济和可靠；它们在开发新模型和记录易变模型方面特别有优势。

由于建模者用来表达数学程序的形式不止一种，因此建模语言也不止一种。代数建模语言 (algebraic modeling language) 是一种流行的变体，它基于使用传统数学符号来描述目标函数和约束函数 (constraint function)。代数语言提供了人们熟悉的符号的计算机可读等价物，例如 $x_j + y_j$、$\sum_{j = 1}^{n}a_{ij}x_j$、$x_j\geq 0$ 和 $j\in S$，这些符号对于任何学过代数或微积分的人来说都很熟悉。熟悉性是代数建模语言的主要优势之一；另一个优势是它们适用于各种各样的线性、非线性和整数规划模型。

虽然成功的数学规划算法早在 20 世纪 50 年代就开始投入使用，但代数建模语言的开发和分发直到 20 世纪 70 年代才开始。从那时起，计算和计算机科学的进步使得这些语言变得越来越高效和通用。

本书描述了 AMPL，一种用于数学规划的代数建模语言；它由作者在 1985 年左右设计和实现，并且从那时起一直在发展。AMPL 以其算术表达式与常规代数符号的相似性以及其集合和下标表达式的通用性和强大功能而著称。AMPL 还将代数符号扩展以表达常见的数学规划结构，例如网络流约束 (network flow constraint) 和分段线性 (piecewise linear)。

AMPL 提供了一个交互式命令环境，用于设置和求解数学规划问题。灵活的接口使得多个求解器 (solver) 可以同时可用，因此用户可以在求解器之间切换并选择可能提高求解器性能的选项。一旦找到最优解 (optimal solution)，它们会自动转换回建模者的形式，以便人们可以查看和分析它们。AMPL 建模语言的所有通用集合和算术表达式也可以用于显示数据和结果；有各种选项可用于格式化数据，以便浏览、打印报告或准备输入到其他程序。

由于强调 AMPL，本书在建模呈现方式上与标准数学规划教材存在显著差异。传统教科书的方法仍深受 30 年前情况的影响，当时学生能有机会在实际计算机上求解几个小型线性规划问题已是幸运。在这些教科书中，数学规划往往只涉及将“文字问题”转换为一组小型不等式和目标函数，然后提交给一个简单的优化软件包，输出一份简短的答案列表。虽然这种方法在入门教学中可能是有效的，但它无法应对现实世界中数学规划问题常见的成百上千个变量和约束。

代数建模语言的出现，使得我们可以重点关注用于描述大规模优化问题的通用模型类型。本书中的每个 AMPL 模型都描述了一类完整的数学规划问题，其成员对应于不同的索引集和数值数据选择。尽管我们使用相对较小的数据集进行说明，但由此产生的问题通常比典型教科书中的例子要大。更重要的是，同样的方法在使用更大规模的数据集时依然有效，能够处理具有实际规模和实用价值的数学规划问题。

我们并未试图涵盖构成大多数数学规划教材主要内容的优化理论和算法细节。因此，对于希望深入研究该领域的读者而言，本书是对现有教材的补充，而非替代。另一方面，对于那些希望将数学规划应用于特定问题的读者，本书本身即可提供有用的入门指导。

此外，AMPL 软件易于获取并用于实验：AMPL 网站 www.ampl.com 提供可免费下载的“学生版”AMPL 及代表性求解器，支持 Windows、Unix/Linux 和 Mac OS X 系统。这些版本可轻松处理包含数百个变量和约束的问题，包括本书中的所有示例。支持更大规模问题和更多求解器的版本也可从多家供应商处获得；详细信息请参见网站说明。

# 本书结构

第二版与第一版一样，在概念上分为四个部分。第 1 至 4 章是线性规划模型的入门教程：

1. 生产模型：利润最大化  
2. 饮食与其他输入模型：成本最小化  
3. 运输与指派模型  
4. 构建更大规模的模型

这些章节旨在让你尽快开始使用 AMPL。其中包括对线性规划的简要回顾，以及对一些简单建模思想的讨论，这些思想是大多数大规模优化问题的基础。同时，它们还说明了如何提供将模型转化为特定问题实例所需的数据、如何求解问题以及如何显示答案。

接下来的四章详细描述了 AMPL 线性规划模型的基本组成部分，使用更复杂的例子来系统地探讨语言的主要方面：

5. 简单集合与索引  
6. 复合集合与索引  
7. 参数与表达式  
8. 线性规划：变量、目标与约束 (Linear Programs: Variables, Objectives and Constraints)

我们尝试涵盖了最重要的功能，使这些章节可以作为通用用户指南。每个功能都通过一个或多个示例引入，并尽可能在先前示例的基础上进行构建。

以下六章描述了如何以更复杂的方式使用 AMPL：

9. 指定数据 (Specifying Data)  
10. 数据库访问 (Database Access)  
11. 建模命令 (Modeling Commands)  
12. 显示命令 (Display Commands)  
13. 命令脚本 (Command Scripts)  
14. 与求解器交互 (Interactions with Solvers)

前两章解释了如何提供定义模型特定实例所需的数据值；第 9 章描述了 AMPL 的文本文件数据格式，而第 10 章介绍了访问关系数据库系统中信息的功能。第 11 章解释了用于读取模型和数据以及调用求解器的命令；第 12 章展示了如何显示和保存结果。AMPL 提供了创建命令脚本以及编写循环和条件语句的功能；这些内容在第 13 章中介绍。第 14 章更详细地探讨了如何与求解器交互，以便充分利用其功能和所提供的信息。

最后，我们转向纯线性模型之外的丰富多样的问题和应用。其余章节讨论了六个重要的特殊情况和推广：

15. 网络线性规划 (Network Linear Programs)  
16. 列式表述 (Columnwise Formulations)  
17. 分段线性规划 (Piecewise-Linear Programs)  
18. 非线性规划 (Nonlinear Programs)  
19. 互补问题 (Complementarity Problems)  
20. 整数线性规划 (Integer Linear Programs)

第 15 章和第 16 章描述了有助于 AMPL 更自然地表示特定类型线性规划的附加语言功能，并可能有助于加快翻译和求解过程。最后四章涵盖了有助于使模型比线性规划更现实的推广，尽管它们也可能使最终的优化问题更难求解。

附录 A 是 AMPL 参考手册；它描述了所有语言功能，包括文本中未在其他地方提及的一些功能。大多数章节中都可以找到参考文献和练习。

# 关于第二版

在十年间，AMPL 发生了很多变化，但其核心基本保持不变，几乎所有第一版中的模型都可以在当前的程序中运行。虽然我们对全文进行了大量修订，但大部分全新的内容都集中在第三部分，原来关于命令环境的单一章节已扩展为五个章节。特别是数据库访问、脚本和编程结构代表了全新的内容，同时新增了许多用于检查模型和访问求解器信息的 AMPL 命令。

第一版撰写于 1992 年，正值互联网和网络使用爆发之前，当时个人计算机的功能仍然相当有限；最早的 AMPL 学生版本运行在 DOS 系统上，安装在微小而缓慢的机器上，并通过软盘进行分发。

如今，网站 www.ampl.com 是所有 AMPL 信息和软件的中心来源。该网站页面涵盖了您需要了解和实验优化及 AMPL 使用的所有内容：

- 适用于各种操作系统的 AMPL 免费版本。
- 适用于各种问题类型的多个求解器的免费版本。
- 本书中用作示例的所有模型和数据文件。

免费软件功能完整，只是只能处理几百个变量和约束的问题。同时也有不受限制的商业版本的 AMPL 和求解器；请参见网站上的供应商列表。

您也可以通过浏览器接口在 www.ampl.com/TRYAMPL 和 NEOS 服务器 (neos.mcs.anl.gov) 上尝试 AMPL，而无需下载任何软件。AMPL 网站还提供了关于图形用户界面和新 AMPL 语言特性的信息，这些特性正在持续开发中。

# 致第一版的致谢

我们深深感谢 乔恩·本特利 (Jon Bentley) 和 玛格丽特·赖特 (Margaret Wright)，他们对本书手稿的多个草稿进行了详尽的评论。我们还收到了来自 科莱特·库拉德 (Collette Coullard)、加里·克拉默 (Gary Cramer)、阿尔内·德鲁德 (Arne Drud)、格雷斯·埃姆林 (Grace Emlin)、古斯·古斯曼 (Gus Gussmann)、埃里克·格罗斯 (Eric Grosse)、保罗·凯利 (Paul Kelly)、马克·科尼汉 (Mark Kernighan)、托德·洛 (Todd Lowe)、鲍勃·里克顿 (Bob Richton)、迈克尔·桑德斯 (Michael Saunders)、罗伯特·赛普 (Robert Seip)、拉克什曼·辛哈 (Lakshman Sinha)、克里斯·范·韦克 (Chris Van Wyk)、朱莉安娜·维尼亚利 (Juliana Vignali)、通·武哈克 (Thong Vukhac) 以及西北大学数学规划课程的学生们关于 AMPL 和本书的许多有益建议。洛琳达·切里 (Lorinda Cherry) 协助了索引编制，杰罗姆·谢泼德 (Jerome Shepheard) 协助了排版。我们向他们所有人致以诚挚的谢意。

# 参考文献

[1] E. M. L. Beale, “Matrix Generators and Output Analyzers.” In Harold W. Kuhn (ed.), Proceedings of the Princeton Symposium on Mathematical Programming, Princeton University Press (Princeton, NJ, 1970) pp. 25-36. 一本关于线性规划矩阵生成器软件的历史与解释的著作。

[2] Johannes Bisschop and Alexander Meeraus, “On the Development of a General Algebraic Modeling System in a Strategic Planning Environment.” Mathematical Programming Study 20 (1982) pp. 1-29. 一篇介绍 GAMS（最早且使用最广泛的代数建模语言之一）的文章。

[3] Robert E. Bixby, “Solving Real-World Linear Programs: A Decade and More of Progress.” Operations Research 50 (2002) pp. 3-15. 关于线性规划求解器近期进展的历史回顾。本期还收录了该领域先驱对数学规划早期发展的记述。

[4] George B. Dantzig, “Linear Programming: The Story About How It Began.” In Jan Karel Lenstra, Alexander H. G. Rinnooy Kan and Alexander Schrijver, eds., History of Mathematical Programming: A Collection of Personal Reminiscences. North-Holland (Amsterdam, 1991) pp. 19-31. 我们关于线性规划历史简要叙述的来源。丹齐格是诸如目标函数和单纯形法等关键思想的先驱。

罗伯特·弗勒, “Modeling Languages versus Matrix Generators for Linear Programming.” ACM Transactions on Mathematical Software 9 (1983) pp. 143- 183。支持建模语言的论证。

C. A. C. Kuip, “Algebraic Languages for Mathematical Programming.” European Journal of Operational Research 67 (1993) 25-51。一项综述。
